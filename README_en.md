<!-- 语言选择 / Language Selection -->
**[🇨🇳 中文](README.md)** | **[🇺🇸 English](README_en.md)**

---

# VS Code Diagnostics Dumper

A VS Code extension for real-time monitoring and exporting code diagnostics information. This extension automatically exports errors, warnings, and other diagnostic data to JSON files for external tools analysis and processing.

## ✨ Features

- **Real-time Monitoring**: Automatically listens to all diagnostic changes in VS Code (errors, warnings, information, etc.)
- **Smart Debouncing**: Built-in 200ms debounce mechanism to avoid frequent file write operations
- **Multi-window Isolation**: Each VS Code window automatically generates independent diagnostic files in their respective workspace root directories
- **Startup Cleanup**: Automatically clears diagnostic files on each startup to ensure no residual old information
- **File Filtering**: Support wildcard pattern filtering for unwanted file types (e.g., *.md, *.png, etc.)
- **Complete Information**: Export detailed diagnostic information including location, severity level, error codes, etc.
- **File Tracking**: Maintain "seen files" records, showing empty diagnostic arrays even after errors are fixed
- **Manual Export**: Provides command palette commands for manual export triggering

## 🚀 Quick Start

### Installation

1. Search for "vscode-diagnostics-dumper" in VS Code Extension Marketplace
2. Click Install and enable the extension

### Usage

The extension starts working automatically after activation:

1. **Automatic Mode**: The extension automatically listens to errors and warnings in your code, updating JSON files in real-time
2. **Manual Export**: Use `Ctrl+Shift+P` to open command palette, search for "Diagnostics Dumper: Dump Now"

## ⚙️ Configuration Options

The extension provides the following configuration options:

### `diagnosticsDumper.excludePatterns`

- **Type**: `string[]`
- **Description**: File filter pattern list, supports wildcard matching
- **Default**: Includes common file types that don't need diagnostics (*.md, *.txt, *.json, *.png, *.jpg, etc.)

**Configuration Example**:

```json
{
  "diagnosticsDumper.excludePatterns": [
    "*.md",           // Exclude all Markdown files
    "*.png",          // Exclude all PNG images
    "AAA.py",         // Exclude specific file
    "docs/**/*",      // Exclude all files in docs directory
    "node_modules/**/*" // Exclude node_modules directory
  ]
}
```

## 📁 Output Directory Strategy

The extension uses an intelligent multi-fallback strategy to automatically determine the output directory:

1. **Workspace Root Directory** (highest priority) - If there's an open workspace
2. **Active File Directory** - If no workspace but there's an open file
3. **System Temporary Directory** - As the final fallback option

**Filename**: Fixed as `vscode-diagnostics.json`, ensuring automatic isolation between multiple VS Code windows

**Advantages**:
- 🔄 **Multi-window Support**: Different VS Code windows generate independent diagnostic files
- 🧹 **Auto Cleanup**: Clears old diagnostic information on each startup
- 📂 **Smart Location**: Automatically selects the most appropriate output directory

## 📄 Output Format

The JSON file structure generated by the extension:

```json
[
  {
    "file": "absolute file path",
    "diagnostics": [
      {
        "message": "error message",
        "severity": 0,
        "level": "Error",
        "source": "TypeScript",
        "code": "2322",
        "start": { "line": 10, "character": 15 },
        "end": { "line": 10, "character": 25 }
      }
    ]
  }
]
```

### Severity Levels

- `0` / `"Error"`: Error
- `1` / `"Warning"`: Warning  
- `2` / `"Information"`: Information
- `3` / `"Hint"`: Hint

## 🛠️ Development Environment & Toolchain

### Project Foundation

This extension is built using **Yeoman scaffolding** with modern VS Code extension development toolchain:

- **VS Code Version**: >= 1.102.0
- **Node.js**: >= 18.x (ES2022 support)
- **TypeScript**: >= 5.8.3
- **Development Tools**:
  - `yo generator-code` - Yeoman VS Code extension generator
  - `@vscode/vsce` - VS Code extension packaging and publishing tool

### Development Environment Setup

```bash
# Install scaffolding tools globally
npm install -g yo generator-code
npm install -g @vscode/vsce

# Create new extension project
yo code

# Install project dependencies
npm install
```

### Development Commands

```bash
# Compile TypeScript
npm run compile

# Watch mode compilation
npm run watch

# Code quality check
npm run lint

# Run tests
npm run test

# Package extension
vsce package

# Publish to marketplace
vsce publish
```

## 📋 Available Commands

| Command | Description |
|---------|-------------|
| `Diagnostics Dumper: Dump Now` | Manually trigger diagnostic information export |

## 🔧 How It Works

1. **Startup Initialization**: Extension clears diagnostic files on activation to ensure clean state
2. **Listening Mechanism**: Uses `vscode.languages.onDidChangeDiagnostics` API to listen for diagnostic changes
3. **File Filtering**: Filters unwanted files based on configured pattern rules (e.g., images, documentation)
4. **Data Collection**: Gets all current diagnostic information through `vscode.languages.getDiagnostics()`
5. **Smart Caching**: Maintains "seen files" set to ensure files appear in output even after errors are fixed
6. **Debounce Processing**: 200ms delayed write to avoid frequent IO operations
7. **Directory Strategy**: Intelligently selects output directory (workspace → active file directory → temp directory)

## 📦 Technical Implementation

### Core Technology Stack

- **Language**: TypeScript (ES2022)
- **Core API**: VS Code Extension API (v1.102.0+)
- **Testing Framework**: @vscode/test-cli + Mocha
- **Build Tools**: TypeScript Compiler + ESLint
- **Packaging Tool**: @vscode/vsce

### Main Dependencies

**Production Dependencies**:
- `minimatch` (^10.0.3) - Wildcard pattern matching

**Development Dependencies**:
- `@vscode/test-cli` (^0.0.11) - VS Code testing command line tool
- `@vscode/test-electron` (^2.5.2) - Electron test runner
- `typescript` (^5.8.3) - TypeScript compiler
- `eslint` (^9.25.1) - Code quality checker
- `@types/vscode` (^1.102.0) - VS Code API type definitions

### Core Modules

- `vscode.languages` - Diagnostic information retrieval and monitoring
- `vscode.workspace` - Configuration management and workspace detection
- `vscode.window` - Active editor retrieval
- `vscode.commands` - Command registration and execution
- Node.js `fs`, `path`, `os` - File system operations

### Project Structure

```
├── src/
│   ├── extension.ts          # Main extension logic
│   └── test/
│       └── extension.test.ts # Test cases
├── out/                      # Compilation output directory
├── package.json              # Extension manifest and dependencies
├── tsconfig.json             # TypeScript configuration
├── eslint.config.mjs         # ESLint configuration
└── LICENSE                   # MIT License
```

## 🐛 Known Issues

No major known issues at the moment. If you encounter problems, please submit an issue in the project repository.

## 📝 Changelog

### 1.0.3 (Current Version)

- ✨ **New**: Cursor Editor compatibility, fully compatible with Cursor environment
- ✨ **New**: File filtering functionality with wildcard pattern matching support
- ✨ **New**: Automatic diagnostic file cleanup on startup to resolve residual issues
- ♻️ **Refactor**: Output directory strategy with multi-window automatic isolation support
- 🔧 **Remove**: outputDir configuration option, replaced with intelligent auto-selection
- ✅ Basic diagnostic information export functionality
- ✅ Real-time listening and debounce mechanism
- ✅ Manual export command
- ✅ Complete diagnostic information structure

### 0.0.1 (Historical Version)

- ✅ Initial version with basic functionality implementation

## 🤝 Development & Contributing

### Local Development

1. **Clone Repository**:
   ```bash
   git clone <repository-url>
   cd vscode-diagnostics-dumper
   ```

2. **Install Dependencies**:
   ```bash
   npm install
   ```

3. **Development Debugging**:
   - Open project in VS Code
   - Press `F5` to launch Extension Development Host window
   - Test extension functionality in the new window

4. **Run Tests**:
   ```bash
   npm run test
   ```

5. **Package Testing**:
   ```bash
   vsce package
   ```

### Contributing Guidelines

Pull Requests and Issues are welcome!

- 🐛 **Bug Reports**: Please provide detailed reproduction steps
- 💡 **Feature Requests**: Describe requirements and use cases
- 🔧 **Code Contributions**: Follow project coding standards and testing requirements

## 📄 License

This project is licensed under the [MIT License](LICENSE).

---

**Happy Coding!** 🎉