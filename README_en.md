<!-- 语言选择 / Language Selection -->
**[🇨🇳 中文](README.md)** | **[🇺🇸 English](README_en.md)**

---

# VS Code Diagnostics Dumper

A VS Code extension for real-time monitoring and exporting code diagnostics information. This extension automatically exports errors, warnings, and other diagnostic data to JSON files for external tools analysis and processing.

## ✨ Features

- **Real-time Monitoring**: Automatically listens to all diagnostic changes in VS Code (errors, warnings, information, etc.)
- **Smart Debouncing**: Built-in 200ms debounce mechanism to avoid frequent file write operations
- **Multi-window Isolation**: Each VS Code window automatically generates independent diagnostic files in their respective workspace root directories
- **Startup Cleanup**: Automatically clears diagnostic files on each startup to ensure no residual old information
- **File Filtering**: Support wildcard pattern filtering for unwanted file types (e.g., *.md, *.png, etc.)
- **Complete Information**: Export detailed diagnostic information including location, severity level, error codes, etc.
- **File Tracking**: Maintain "seen files" records, showing empty diagnostic arrays even after errors are fixed
- **Manual Export**: Provides command palette commands for manual export triggering

## 🚀 Quick Start

### Installation

1. Search for "vscode-diagnostics-dumper" in VS Code Extension Marketplace
2. Click Install and enable the extension

### Usage

The extension starts working automatically after activation:

1. **Automatic Mode**: The extension automatically listens to errors and warnings in your code, updating JSON files in real-time
2. **Manual Export**: Use `Ctrl+Shift+P` to open command palette, search for "Diagnostics Dumper: Dump Now"

## ⚙️ Configuration Options

The extension provides the following configuration options:

### `diagnosticsDumper.excludePatterns`

- **Type**: `string[]`
- **Description**: File filter pattern list, supports wildcard matching
- **Default**: Includes common file types that don't need diagnostics (*.md, *.txt, *.json, *.png, *.jpg, etc.)

**Configuration Example**:

```json
{
  "diagnosticsDumper.excludePatterns": [
    "*.md",           // Exclude all Markdown files
    "*.png",          // Exclude all PNG images
    "AAA.py",         // Exclude specific file
    "docs/**/*",      // Exclude all files in docs directory
    "node_modules/**/*" // Exclude node_modules directory
  ]
}
```

## 📁 Output Directory Strategy

The extension uses an intelligent multi-fallback strategy to automatically determine the output directory:

1. **Workspace Root Directory** (highest priority) - If there's an open workspace
2. **Active File Directory** - If no workspace but there's an open file
3. **System Temporary Directory** - As the final fallback option

**Filename**: Fixed as `vscode-diagnostics.json`, ensuring automatic isolation between multiple VS Code windows

**Advantages**:
- 🔄 **Multi-window Support**: Different VS Code windows generate independent diagnostic files
- 🧹 **Auto Cleanup**: Clears old diagnostic information on each startup
- 📂 **Smart Location**: Automatically selects the most appropriate output directory

## 📄 Output Format

The JSON file structure generated by the extension:

```json
[
  {
    "file": "absolute file path",
    "diagnostics": [
      {
        "message": "error message",
        "severity": 0,
        "level": "Error",
        "source": "TypeScript",
        "code": "2322",
        "start": { "line": 10, "character": 15 },
        "end": { "line": 10, "character": 25 }
      }
    ]
  }
]
```

### Severity Levels

- `0` / `"Error"`: Error
- `1` / `"Warning"`: Warning  
- `2` / `"Information"`: Information
- `3` / `"Hint"`: Hint

## 🛠️ Development Requirements

- VS Code version >= 1.102.0
- Node.js (for development and compilation)

## 📋 Available Commands

| Command | Description |
|---------|-------------|
| `Diagnostics Dumper: Dump Now` | Manually trigger diagnostic information export |

## 🔧 How It Works

1. **Startup Initialization**: Extension clears diagnostic files on activation to ensure clean state
2. **Listening Mechanism**: Uses `vscode.languages.onDidChangeDiagnostics` API to listen for diagnostic changes
3. **File Filtering**: Filters unwanted files based on configured pattern rules (e.g., images, documentation)
4. **Data Collection**: Gets all current diagnostic information through `vscode.languages.getDiagnostics()`
5. **Smart Caching**: Maintains "seen files" set to ensure files appear in output even after errors are fixed
6. **Debounce Processing**: 200ms delayed write to avoid frequent IO operations
7. **Directory Strategy**: Intelligently selects output directory (workspace → active file directory → temp directory)

## 📦 Technical Implementation

- **Language**: TypeScript
- **Core API**: VS Code Extension API
- **Main Dependencies**:
  - `minimatch` - Wildcard pattern matching
- **Main Modules**:
  - `vscode.languages` - Diagnostic information retrieval
  - `vscode.workspace` - Configuration management and workspace detection
  - `vscode.window` - Active editor retrieval
  - `vscode.commands` - Command registration
  - Node.js `fs`, `path`, `os` - File system operations

## 🐛 Known Issues

No major known issues at the moment. If you encounter problems, please submit an issue in the project repository.

## 📝 Changelog

### 1.0.2 (Current Version)

- ✨ **New**: File filtering functionality with wildcard pattern matching support
- ✨ **New**: Automatic diagnostic file cleanup on startup to resolve residual issues
- ♻️ **Refactor**: Output directory strategy with multi-window automatic isolation support
- 🔧 **Remove**: outputDir configuration option, replaced with intelligent auto-selection
- ✅ Basic diagnostic information export functionality
- ✅ Real-time listening and debounce mechanism
- ✅ Manual export command
- ✅ Complete diagnostic information structure

### 0.0.1 (Historical Version)

- ✅ Initial version with basic functionality implementation

## 🤝 Contributing

Pull Requests and Issues are welcome!

## 📄 License

This project uses the standard VS Code extension license.

---

**Happy Coding!** 🎉